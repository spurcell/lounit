/**
 * A test reporter that renders its output to the command line.
 *
 * If `out` is provided renders lines immediately; otherwise buffers them.
 */
create is <-> (out) {
    
    report      = "";
    numFailed   = 0;
    
    // OWNER FACET
    
    reply (
        
        /**
         * Adds a test result to this report.
         */
        
        addResult: <-> (name, passed) {
                        
            summary = passed ? "✔" : "✖" >< " `name`\n";
            
            if out {
                out.write(summary);
            }
            else {
                report = report >< summary;
            }
            
            numFailed += passed ? 0 : 1;
        },
        
        /**
         * Finalizes this test report, returning true if all tests passed.
         */
        finalize: <-> {
            
            out.write(numFailed == 0 ? "ALL PASSED\n" : "`numFailed` FAILED\n");
            
            reply numFailed == 0;
        }
    );
};